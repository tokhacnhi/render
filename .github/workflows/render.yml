name: Render

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      clips:
        description: 'link zip'
        required: true
      subs:
        description: 'link subtitle'
        required: false
      audio:
        required: true
      
      webhook:
        required: true

jobs:
  render-subtitle:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v6
        with:
          python-version: '3.13'
          cache: 'pip'
      - run: pip install -r requirements.txt

      - uses: FedericoCarboni/setup-ffmpeg@v3
        with:
          ffmpeg-version: release

      - run: |
          sudo apt-get update
          sudo apt-get install -y fonts-nanum
          
      - run: |
          set -a
          source params.env
          set +a

          wget -O clips.zip "$CLIPS"
          unzip clips.zip -d clips

          wget -O sub.txt "$SUBS"
          wget -O audio.mp3 "$AUDIO"

          RESULT=$(python render.py)

          curl -X POST -H "Content-Type: application/json" \
            -d "{\"status\": \"done\", \"data\": \"$RESULT\"}" \
            "${{ $WEBHOOK }}"




      
